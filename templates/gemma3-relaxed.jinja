{# Relaxed Gemma 3 chat template - no role alternation enforcement #}
{# This allows tool-calling agents like Goose to work without hitting the #}
{# "Conversation roles must alternate user/assistant" error #}
{{- bos_token -}}
{%- for message in messages -%}
    {%- if message['role'] == 'user' -%}
        {{- '<start_of_turn>user\n' + message['content'] | trim + '<end_of_turn>\n' -}}
    {%- elif message['role'] == 'assistant' -%}
        {{- '<start_of_turn>model\n' + message['content'] | trim + '<end_of_turn>\n' -}}
    {%- elif message['role'] == 'system' -%}
        {{- '<start_of_turn>user\n' + message['content'] | trim + '<end_of_turn>\n' -}}
        {{- '<start_of_turn>model\nUnderstood.<end_of_turn>\n' -}}
    {%- elif message['role'] == 'tool' -%}
        {{- '<start_of_turn>user\nTool result: ' + message['content'] | trim + '<end_of_turn>\n' -}}
    {%- endif -%}
{%- endfor -%}
{%- if add_generation_prompt -%}
    {{- '<start_of_turn>model\n' -}}
{%- endif -%}
